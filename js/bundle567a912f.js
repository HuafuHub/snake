(()=>{"use strict";const t=function(){function t(){this.maxX=49,this.maxY=49,this._food=this.createFood()}return t.prototype.cross=function(t){return!(t.x<0||t.x>this.maxX||t.y<0||t.y>this.maxY)},t.prototype.exsit=function(t,e){return(t.x!==e.point.x||t.y!==e.point.y)&&(!e.next||this.exsit(t,e.next))},t.prototype.getRandom=function(t,e){return Math.floor(Math.random()*(e-t+1)+t)},t.prototype.createFood=function(){return{x:this.getRandom(0,this.maxX),y:this.getRandom(0,this.maxY)}},t.prototype.test=function(t,e){return this.cross(t)&&this.exsit(t,e)},t.prototype.getFood=function(t){return t?(this._food=this.createFood(),this._food):this._food},t}(),e=function(){function t(){this._canvas=document.getElementById("snake"),this._ctx=this._canvas.getContext("2d")}return t.prototype.draw=function(t,e){this._ctx.beginPath(),this._ctx.rect(10*t.point.x,10*t.point.y,10,10),this._ctx.fillStyle=t===e?"#f20":"#fff",this._ctx.fill()},t.prototype.show=function(t){this.clear();var e=t;for(this.draw(e,t);e.next;)e=e.next,this.draw(e,t)},t.prototype.tip=function(t,e){var i=30*t.length;this.clear(),this._ctx.beginPath(),this._ctx.fillStyle=e||"#fff",this._ctx.font="30px Verdana",this._ctx.fillText(t,this._canvas.width/2-i/2,this._canvas.height/2)},t.prototype.clear=function(){var t=this._canvas.width,e=this._canvas.height;this._ctx.clearRect(0,0,t,e)},t.prototype.food=function(t){this._ctx.beginPath(),this._ctx.rect(10*t.x,10*t.y,10,10),this._ctx.fillStyle="yellowgreen",this._ctx.fill()},t}(),i=function(){function t(t,e){this._point={x:t,y:e}}return Object.defineProperty(t.prototype,"point",{get:function(){return this._point},set:function(t){this._point=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"prev",{get:function(){return this._prev},set:function(t){this._prev=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"next",{get:function(){return this._next},set:function(t){this._next=t},enumerable:!1,configurable:!0}),t}();var o;!function(t){t[t.up=0]="up",t[t.right=1]="right",t[t.down=2]="down",t[t.left=3]="left"}(o||(o={}));const n=function(){function t(t){this._dir=o.right,this._head=new i(t,0),this.initSnake(t)}return t.prototype.initSnake=function(t){if(t>0)for(var e=t,o=this._head;--e;){var n=new i(e%t,0);o.next=n,n.prev=o,o=n}},t.prototype.showSnake=function(){this._viewer&&this._viewer.show(this._head)},t.prototype.getPoint=function(t,e){var i;switch(this._dir){case o.left:i={x:e?t.point.x-1:t.point.x+1,y:t.point.y};break;case o.right:i={x:e?t.point.x+1:t.point.x-1,y:t.point.y};break;case o.up:i={x:t.point.x,y:e?t.point.y-1:t.point.y+1};break;case o.down:i={x:t.point.x,y:e?t.point.y+1:t.point.y-1}}return i},t.prototype.forward=function(t){return t.next&&this.forward(t.next),t.prev?(t.point=t.prev.point,!1):this.testSnake()},t.prototype.testSnake=function(){var t=this.getPoint(this._head,!0);return this.eatFood(t),!(!this._ruler||this._ruler.test(t,this._head))||(this._head.point=t,!1)},t.prototype.demise=function(){this.stop(),this._game&&this._game.over()},t.prototype.showFood=function(t){var e,i,o=null===(e=this._ruler)||void 0===e?void 0:e.getFood(t);null===(i=this._viewer)||void 0===i||i.food(o)},t.prototype.eatFood=function(t){var e=this._ruler.getFood(!1);t.x===e.x&&t.y===e.y&&(this.add(),this._ruler.getFood(!0),this._game.update())},t.prototype.stop=function(){clearInterval(this._timer)},t.prototype.add=function(){for(var t,e=this._head;e.next;)e=e.next;var o=this.getPoint(e);t=new i(o.x,o.y),e.next=t,t.prev=e,this.showSnake()},t.prototype.move=function(){this.forward(this._head)?this.demise():(this.showSnake(),this.showFood(!1))},t.prototype.autoMove=function(t){var e=this;this.stop(),this._timer=setInterval((function(){e.move()}),t)},Object.defineProperty(t.prototype,"viewer",{get:function(){return this._viewer},set:function(t){this._viewer=t,this.showSnake()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ruler",{set:function(t){this._ruler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"game",{set:function(t){this._game=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dir",{get:function(){return this._dir},set:function(t){this._dir=t},enumerable:!1,configurable:!0}),t}();new(function(){function i(t){this._len=t,this._status="init",this._score=0,this._level=1,this._time=200,this._scoreDom=document.querySelector(".score"),this._statusDom=document.querySelector(".status"),this._levelDom=document.querySelector(".level"),this._operateDom=document.querySelector(".operate"),this.init(),this.setStatus("init"),this._snake.viewer.tip("按空格键开始游戏"),this._operateDom.innerHTML="按空格键开始游戏"}return i.prototype.init=function(){this.bindEvent(),this._snake=new n(this._len),this._snake.viewer=new e,this._snake.ruler=new t,this._snake.game=this,this.setScore(0),this.setLevel(1)},i.prototype.bindEvent=function(){var t=this;document.addEventListener("keydown",(function(e){var i,n=t._snake;switch(e.code){case"ArrowRight":n.dir!==o.down&&n.dir!==o.up||(n.dir=o.right);break;case"ArrowLeft":n.dir!==o.down&&n.dir!==o.up||(n.dir=o.left);break;case"ArrowDown":n.dir!==o.right&&n.dir!==o.left||(n.dir=o.down);break;case"ArrowUp":n.dir!==o.right&&n.dir!==o.left||(n.dir=o.up);break;case"Space":"playing"===t._status?t.pause():t.start()}e.code.startsWith("Arrow")&&(null===(i=t._snake)||void 0===i||i.move())}),!1)},i.prototype.setScore=function(t){this._score=t,this._scoreDom.innerHTML="吞噬："+this._score},i.prototype.setStatus=function(t){switch(this._status=t,this._status){case"init":this._statusDom.innerHTML="状态：初始化";break;case"playing":this._statusDom.innerHTML="状态：游戏中";break;case"stop":this._statusDom.innerHTML="状态：游戏暂停";break;case"over":this._statusDom.innerHTML="状态：游戏结束"}},i.prototype.setLevel=function(t){this._level=t,this._levelDom.innerHTML="难度："+this._level},i.prototype.start=function(){"over"===this._status&&this.init(),this.setStatus("playing"),this._snake.autoMove(this._time),this._operateDom.innerHTML="按空格键暂停游戏"},i.prototype.pause=function(){this.setStatus("stop"),this._snake.stop(),this._operateDom.innerHTML="按空格键继续游戏"},i.prototype.over=function(){var t=this;this.setStatus("over"),this._snake.viewer.tip("游戏结束！","orangered"),setTimeout((function(){t._snake.viewer.tip("按空格键重新开始游戏","yellowgreen"),t._operateDom.innerHTML="按空格键重新游戏"}),1e3)},i.prototype.update=function(){this.setScore(this._score+1)},i}())(3)})();